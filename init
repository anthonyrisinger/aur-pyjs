#!/bin/bash
# bootstrap pyjamas AUR

exec 3> /dev/null

spushd () { pushd ${1} >&3; }
spopd () { popd >&3; }

PYJS_SANDBOX=${1:-false}
E_CODE=0

${PYJS_SANDBOX} && {

    spushd "$(dirname ${0})"
    
    if [ -e .pyjs/.git ]; then
        git --git-dir=.pyjs/.git pull
    else
        git clone git://pyjs.org/git/pyjamas.git .pyjs
    fi

    # run bootstrap everytime
    if [ -d .pyjs ]; then
        spushd .pyjs
        make local-build ||
            { echo 'problem bootstrapping pyjs sandbox'; E_CODE=1; }
        spopd
    fi

    spopd

}

exit ${E_CODE}
